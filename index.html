<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <style>
        th {
            color: #fff;
        }
    </style>

    <input type="button" class="btn btn-primary" value="white Chocolate Mocha" onclick="send(whiteChocolateMocha);" />
    <input type="button" class="btn btn-primary" value="macchiato" onclick="send(macchiato);" />
    <input type="button" class="btn btn-primary" value="latte" onclick="send(latte);" />
    <input type="button" class="btn btn-primary" value="cool Lime" onclick="send(coolLime);" />
    <input type="button" class="btn btn-primary" value="berry Hibiscus" onclick="send(berryHibiscus);" />
    <input type="button" class="btn btn-primary" value="türk Kahvesi" onclick="send(türkKahvesi);" />
    <input type="button" class="btn btn-primary" value="pumpkin Spice Latte" onclick="send(pumpkinSpiceLatte);" />
    <input type="button" class="btn btn-primary" value="salted Caramel" onclick="send(saltedCaramel);" /><br><br>

    <table class="table table-striped">
        <tr class="bg-info">
            <th>Coffie Name</th>
            <th>Coffie Size</th>
            <th>Estimated Delivery Time</th>
            <th>Order Time</th>
            <th></th>
        </tr>

        <tbody id="ordersTable">

        </tbody>
    </table>

    <script>
        async function send(coffie) {
            await _send(coffie)
                //window.location.reload()
        }

        async function _send(coffie) {
            const order = JSON.stringify(coffie)
            xhr.open("POST", "http://localhost:12345/getorder")
            xhr.setRequestHeader("Content-Type", "application/json")
            xhr.send(order)
        }

        const whiteChocolateMocha = {
            CoffieName: "white chocolate mocha",
            CoffieSize: "ultraMega"
        };
        const macchiato = {
            CoffieName: "macchiato",
            CoffieSize: "ultraMega"
        };
        const latte = {
            CoffieName: "latte",
            CoffieSize: "ultraMega"
        };
        const coolLime = {
            CoffieName: "cool lime",
            CoffieSize: "ultraMega"
        };
        const berryHibiscus = {
            CoffieName: "berry hibiscus",
            CoffieSize: "ultraMega"
        };
        const türkKahvesi = {
            CoffieName: "türk kahvesi",
            CoffieSize: "ultraMega"
        };
        const pumpkinSpiceLatte = {
            CoffieName: "pumpkin spice latte",
            CoffieSize: "ultraMega"
        };
        const saltedCaramel = {
            CoffieName: "salted caramel",
            CoffieSize: "ultraMega"
        };



        const xhr = new XMLHttpRequest()

        xhr.open("GET", "http://localhost:12345/listorders");
        xhr.send();

        xhr.onload = () => {
            orders = JSON.parse(xhr.response)
                // console.log(typeof orders[0]._id)
            BuildOrdersTable(orders)
        }

        function BuildOrdersTable(data) {
            var table = document.getElementById('ordersTable')

            for (var i = 0; i < data.length; i++) {
                var row = `<tr>
							<td>${data[i].CoffieName}</td>
							<td>${data[i].CoffieSize}</td>
							<td>${data[i].EstimatedDeliveryTime}</td>
							<td>${data[i].OrderTime}</td>
							<td><input type="button" class="btn btn-primary" value="Complate Order" onclick="ComplateOrder(${data[i]});" /></td>
					        </tr>`
                table.innerHTML += row
            }
        }

        function ComplateOrder(order) {
            console.log("complate order çalıştı")
            xhr.open("POST", "http://localhost:12345/deliverorder")
            xhr.setRequestHeader("Content-Type", "application/json")
            xhr.send(order)
        }
    </script>
</body>

</html>